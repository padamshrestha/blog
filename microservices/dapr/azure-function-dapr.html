<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Azure function with Dapr to create event-driven, distributed application | PS Notes</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicon.png">
    <meta name="description" content="Find all my notes here">
    <link rel="preload" href="/blog/assets/css/0.styles.165084a3.css" as="style"><link rel="preload" href="/blog/assets/js/app.5359efb0.js" as="script"><link rel="preload" href="/blog/assets/js/2.ed81277b.js" as="script"><link rel="preload" href="/blog/assets/js/5.8f43166e.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.798258e1.js"><link rel="prefetch" href="/blog/assets/js/11.c40a9d89.js"><link rel="prefetch" href="/blog/assets/js/12.2bf01719.js"><link rel="prefetch" href="/blog/assets/js/13.3ded62bf.js"><link rel="prefetch" href="/blog/assets/js/14.96e88526.js"><link rel="prefetch" href="/blog/assets/js/15.02dfcd09.js"><link rel="prefetch" href="/blog/assets/js/16.d594b883.js"><link rel="prefetch" href="/blog/assets/js/17.3ca5b683.js"><link rel="prefetch" href="/blog/assets/js/18.d67bb81d.js"><link rel="prefetch" href="/blog/assets/js/19.87d7e7d4.js"><link rel="prefetch" href="/blog/assets/js/20.81bb1bdb.js"><link rel="prefetch" href="/blog/assets/js/21.393b795e.js"><link rel="prefetch" href="/blog/assets/js/22.b4b05b24.js"><link rel="prefetch" href="/blog/assets/js/23.90ebae71.js"><link rel="prefetch" href="/blog/assets/js/24.4d6315c6.js"><link rel="prefetch" href="/blog/assets/js/25.a8ca678d.js"><link rel="prefetch" href="/blog/assets/js/26.20ff403d.js"><link rel="prefetch" href="/blog/assets/js/27.027798ff.js"><link rel="prefetch" href="/blog/assets/js/28.4fcd7904.js"><link rel="prefetch" href="/blog/assets/js/29.ae9953be.js"><link rel="prefetch" href="/blog/assets/js/3.4239afa8.js"><link rel="prefetch" href="/blog/assets/js/30.05ce7139.js"><link rel="prefetch" href="/blog/assets/js/31.929ba55a.js"><link rel="prefetch" href="/blog/assets/js/32.39a7eb88.js"><link rel="prefetch" href="/blog/assets/js/33.aea2c7ad.js"><link rel="prefetch" href="/blog/assets/js/34.f19214f0.js"><link rel="prefetch" href="/blog/assets/js/35.f9689f85.js"><link rel="prefetch" href="/blog/assets/js/36.491b563f.js"><link rel="prefetch" href="/blog/assets/js/37.01c41598.js"><link rel="prefetch" href="/blog/assets/js/38.fef1137c.js"><link rel="prefetch" href="/blog/assets/js/39.d9080be3.js"><link rel="prefetch" href="/blog/assets/js/4.5fcdffa2.js"><link rel="prefetch" href="/blog/assets/js/40.139a3e51.js"><link rel="prefetch" href="/blog/assets/js/41.42d3a459.js"><link rel="prefetch" href="/blog/assets/js/42.f4ad466b.js"><link rel="prefetch" href="/blog/assets/js/43.d8279406.js"><link rel="prefetch" href="/blog/assets/js/44.0d320ca0.js"><link rel="prefetch" href="/blog/assets/js/45.a0bd664a.js"><link rel="prefetch" href="/blog/assets/js/46.75a5939e.js"><link rel="prefetch" href="/blog/assets/js/47.62271a73.js"><link rel="prefetch" href="/blog/assets/js/48.6519ed03.js"><link rel="prefetch" href="/blog/assets/js/6.ce0118c8.js"><link rel="prefetch" href="/blog/assets/js/7.2b36b85d.js"><link rel="prefetch" href="/blog/assets/js/8.4109f0ce.js"><link rel="prefetch" href="/blog/assets/js/9.c9802138.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.165084a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/blog/" class="router-link-active no-logo home-link"><!----> <span class="site-name">PS Notes</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/blog/home/">
          Home
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/blog/about/">
          About
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Angular</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/home/deploy-angular-app-to-github-io-pages.html" title="Deploy Angular app to github.io pages" class="sidebar-link">Deploy Angular app to github.io pages</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Azure</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Kusto</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/home/kusto-overview.html" title="Kusto Query Language (KQL)" class="sidebar-link">Kusto Query Language (KQL)</a></li><li><a href="/blog/home/dynamic-365-hcm-kusto.html" title="Troubleshoot using Kusto" class="sidebar-link">Troubleshoot using Kusto</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>C#</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/csharp/csharp-fundamentals.html" title="OOP Fundamentals" class="sidebar-link">OOP Fundamentals</a></li><li><a href="/blog/csharp/csharp-features.html" title="C# features" class="sidebar-link">C# features</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spark</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Microservices</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/microservices/dapr/azure-function-dapr.html" aria-current="page" title="Azure function with Dapr to create event-driven, distributed application" class="active sidebar-link">Azure function with Dapr to create event-driven, distributed application</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#system-diagram" title="System Diagram" class="sidebar-link">System Diagram</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#getting-ready" title="Getting Ready" class="sidebar-link">Getting Ready</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#install-dapr" title="Install Dapr" class="sidebar-link">Install Dapr</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#install-dotnet-sdk-3-1-and-azure-functions-core-tools" title="Install dotnet sdk 3.1 and azure-functions-core-tools" class="sidebar-link">Install dotnet sdk 3.1 and azure-functions-core-tools</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#create-azure-function-app" title="Create Azure function App" class="sidebar-link">Create Azure function App</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#create-a-folder-for-a-project-or-clone-empty-project-from-the-git" title="Create a folder for a project or clone empty project from the git" class="sidebar-link">Create a folder for a project or clone empty project from the git</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#navigate-to-the-folder-from-wsl-console" title="Navigate to the folder from WSL console" class="sidebar-link">Navigate to the folder from WSL console</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#add-nuget-packages" title="Add Nuget packages" class="sidebar-link">Add Nuget packages</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#create-function-getmessage-and-add-dapr-pubsub" title="Create Function GetMessage and add Dapr pubsub" class="sidebar-link">Create Function GetMessage and add Dapr pubsub</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#dapr-config-file-config-yaml" title="Dapr config file config.yaml" class="sidebar-link">Dapr config file config.yaml</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#add-messagebus-component-components-messagebus-yaml" title="Add messagebus component /components/messagebus.yaml" class="sidebar-link">Add messagebus component /components/messagebus.yaml</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#run-azure-function-locally" title="Run Azure Function locally" class="sidebar-link">Run Azure Function locally</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#trigger-azure-function-from-wsl-console" title="Trigger Azure function from WSL console" class="sidebar-link">Trigger Azure function from WSL console</a></li><li class="sidebar-sub-header"><a href="/blog/microservices/dapr/azure-function-dapr.html#validate-if-the-message-is-in-pubsub" title="Validate if the message is in Pubsub" class="sidebar-link">Validate if the message is in Pubsub</a></li></ul></li></ul></li><li><a href="/blog/microservices/dapr/dapr-resources.html" title="Resources" class="sidebar-link">Resources</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="azure-function-with-dapr-to-create-event-driven-distributed-application"><a href="#azure-function-with-dapr-to-create-event-driven-distributed-application" class="header-anchor">#</a> Azure function with Dapr to create event-driven, distributed application</h1> <p>In this post we will integrate Azure function app to use Dapr system for pubsub messaging. Azure function could be either triggered by Event Hub or HttpTrigger. For simplicity we will test it with HttpTrigger. <a href="https://github.com/padamshrestha/azure-function-dapr" target="_blank" rel="noopener noreferrer">Project Repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="system-diagram"><a href="#system-diagram" class="header-anchor">#</a> System Diagram</h2> <p><img src="/blog/assets/img/afd1.55b61c3c.png" alt="alt"></p> <ul><li>Azure function provides easier way to integrate with Event Hub</li> <li>Dapr Subsystem hides complexity to deal with PubSub messaging</li></ul> <h2 id="getting-ready"><a href="#getting-ready" class="header-anchor">#</a> Getting Ready</h2> <p><a href="https://dapr.io/" target="_blank" rel="noopener noreferrer">Getting started with dapr<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/quickstart.md" target="_blank" rel="noopener noreferrer">See the dapr Azure Functions quickstart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Requirements</strong></p> <ul><li><a href="https://docs.dapr.io/getting-started/install-dapr/" target="_blank" rel="noopener noreferrer">Dapr installed and configured locally (dapr init)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/azure/azure-functions-core-tools#installing" target="_blank" rel="noopener noreferrer">Azure Functions Core Tools - v3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://dotnet.microsoft.com/download" target="_blank" rel="noopener noreferrer">.NET Core SDK <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>- enables building of the extension locally in the project</li> <li><a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">Node 12<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for local debugging of the JavaScript app Or .Net Azure Function</li></ul> <p>Note: Run Docker on WSL 2 on Windows for better experience</p> <h3 id="install-dapr"><a href="#install-dapr" class="header-anchor">#</a> Install Dapr</h3> <p>Run in WSL window</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>wget <span class="token operator">-</span>q https:<span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>dapr<span class="token operator">/</span><span class="token function">cli</span><span class="token operator">/</span>master<span class="token operator">/</span>install<span class="token operator">/</span>install<span class="token punctuation">.</span>sh <span class="token operator">-</span>O <span class="token operator">-</span> <span class="token punctuation">|</span> <span class="token operator">/</span>bin<span class="token operator">/</span>bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Run to verify</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>dapr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Run init</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>dapr init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Verify Dapr version</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>dapr <span class="token operator">--</span>version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Verify containers are running</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>docker <span class="token function">ps</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/blog/assets/img/afd2.7a94a2f7.png" alt="alt"> <img src="/blog/assets/img/afd3.1a8fd635.png" alt="alt"></p> <h3 id="install-dotnet-sdk-3-1-and-azure-functions-core-tools"><a href="#install-dotnet-sdk-3-1-and-azure-functions-core-tools" class="header-anchor">#</a> Install dotnet sdk 3.1 and azure-functions-core-tools</h3> <p><a href="/blog/tools/dotnetcore-azurefunction-wsl.html">Install dotnet sdk with azure function tools</a></p> <h2 id="create-azure-function-app"><a href="#create-azure-function-app" class="header-anchor">#</a> Create Azure function App</h2> <h3 id="create-a-folder-for-a-project-or-clone-empty-project-from-the-git"><a href="#create-a-folder-for-a-project-or-clone-empty-project-from-the-git" class="header-anchor">#</a> Create a folder for a project or clone empty project from the git</h3> <h3 id="navigate-to-the-folder-from-wsl-console"><a href="#navigate-to-the-folder-from-wsl-console" class="header-anchor">#</a> Navigate to the folder from WSL console</h3> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>dotnet new sln
func init <span class="token keyword">process</span> <span class="token operator">--</span>dotnet <span class="token operator">--</span>docker
dotnet sln azure<span class="token operator">-</span><span class="token keyword">function</span><span class="token operator">-</span>dapr<span class="token punctuation">.</span>sln add <span class="token punctuation">.</span><span class="token operator">/</span><span class="token keyword">process</span><span class="token operator">/</span><span class="token keyword">process</span><span class="token punctuation">.</span>csproj
cd <span class="token keyword">process</span><span class="token operator">/</span>
func new <span class="token operator">--</span>name GetMessage <span class="token operator">--</span>template <span class="token string">&quot;HTTP Trigger&quot;</span> <span class="token operator">--</span>authlevel <span class="token string">&quot;anonymous&quot;</span>

<span class="token function">ps</span>@Dev<span class="token operator">-</span>WD MINGW64 <span class="token operator">/</span>c<span class="token operator">/</span>Projects<span class="token operator">/</span>azure<span class="token operator">-</span><span class="token keyword">function</span><span class="token operator">-</span>dapr<span class="token operator">/</span><span class="token keyword">process</span> <span class="token punctuation">(</span>main<span class="token punctuation">)</span>
$ func extensions install <span class="token operator">-</span>p Dapr<span class="token punctuation">.</span>AzureFunctions<span class="token punctuation">.</span>Extension <span class="token operator">-</span>v 0<span class="token punctuation">.</span>12<span class="token punctuation">.</span>0<span class="token operator">-</span>p
review01
dotnet build <span class="token keyword">process</span><span class="token punctuation">.</span>csproj <span class="token operator">-</span>o bin <span class="token operator">--</span>no<span class="token operator">-</span>incremental
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>To run/debug the function app locally click on &quot;Initialize Project for Use with VS Code&quot;</p> <p><img src="/blog/assets/img/afd4.f081db13.png" alt="alt"></p> <p>Update the connection for the WebStorage and run/debug in VS Code</p> <h3 id="add-nuget-packages"><a href="#add-nuget-packages" class="header-anchor">#</a> Add Nuget packages</h3> <ul><li>Dapr.AzureFunctions.Extension</li> <li>Microsoft.NET.Sdk.Functions</li> <li>Microsoft.Azure.WebJobs.Extensions.EventHubs</li></ul> <h3 id="create-function-getmessage-and-add-dapr-pubsub"><a href="#create-function-getmessage-and-add-dapr-pubsub" class="header-anchor">#</a> Create Function GetMessage and add Dapr pubsub</h3> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Dapr<span class="token punctuation">.</span>AzureFunctions<span class="token punctuation">.</span>Extension</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">process</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GetMessage</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FunctionName</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;GetMessage&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpTrigger</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Anonymous<span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name">HttpRequest</span> req<span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DaprPublish</span><span class="token attribute-arguments"><span class="token punctuation">(</span>PubSubName <span class="token operator">=</span> <span class="token string">&quot;pubsub&quot;</span><span class="token punctuation">,</span> Topic <span class="token operator">=</span> <span class="token string">&quot;alerts&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name">IAsyncCollector<span class="token punctuation">&lt;</span>DaprPubSubEvent<span class="token punctuation">&gt;</span></span> alertEvent<span class="token punctuation">,</span>
            <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;C# HTTP trigger function processed a request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>Query<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">string</span></span> requestBody <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">dynamic</span></span> data <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">DeserializeObject</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name <span class="token operator">??</span> data<span class="token punctuation">?.</span>name<span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">string</span></span> responseMessage <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                <span class="token punctuation">?</span> <span class="token string">&quot;This HTTP triggered function executed successfully. Pass a name in the query string or in the request body for a personalized response.&quot;</span>
                <span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">$&quot;Hello, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">name</span><span class="token punctuation">}</span></span><span class="token string">. This HTTP triggered function executed successfully.&quot;</span></span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> alertEvent<span class="token punctuation">.</span><span class="token function">AddAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DaprPubSubEvent</span><span class="token punctuation">(</span>JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token string">&quot;testobj&quot;</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">&quot;This is a test alert&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OkObjectResult</span><span class="token punctuation">(</span>responseMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="dapr-config-file-config-yaml"><a href="#dapr-config-file-config-yaml" class="header-anchor">#</a> Dapr config file config.yaml</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> dapr.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Configuration
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> daprConfig
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">tracing</span><span class="token punctuation">:</span>
    <span class="token key atrule">samplingRate</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
    <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
      <span class="token key atrule">endpointAddress</span><span class="token punctuation">:</span> <span class="token string">'http://localhost:9411/api/v2/spans'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="add-messagebus-component-components-messagebus-yaml"><a href="#add-messagebus-component-components-messagebus-yaml" class="header-anchor">#</a> Add messagebus component /components/messagebus.yaml</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> dapr.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Component
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pubsub
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> pubsub.redis
  <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisHost
      <span class="token key atrule">value</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">6379</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redisPassword
      <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>password
        <span class="token key atrule">name</span><span class="token punctuation">:</span> redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="run-azure-function-locally"><a href="#run-azure-function-locally" class="header-anchor">#</a> Run Azure Function locally</h3> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>dapr run <span class="token operator">-</span>a functionapp <span class="token operator">-</span>p 3001 <span class="token operator">--</span>components<span class="token operator">-</span>path <span class="token punctuation">.</span><span class="token operator">/</span>components<span class="token operator">/</span> <span class="token operator">--</span>config <span class="token punctuation">.</span><span class="token operator">/</span>config<span class="token punctuation">.</span>yaml <span class="token operator">--</span> func host <span class="token function">start</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="trigger-azure-function-from-wsl-console"><a href="#trigger-azure-function-from-wsl-console" class="header-anchor">#</a> Trigger Azure function from WSL console</h3> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>curl <span class="token operator">-</span>X POST <span class="token operator">-</span>H <span class="token string">&quot;Content-Type: application/json&quot;</span> <span class="token operator">-</span>d <span class="token string">'{ &quot;name&quot;: &quot;John Gray&quot;}'</span> http:<span class="token operator">/</span><span class="token operator">/</span>172<span class="token punctuation">.</span>21<span class="token punctuation">.</span>132<span class="token punctuation">.</span>136:7071<span class="token operator">/</span>api<span class="token operator">/</span>GetMessage
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="validate-if-the-message-is-in-pubsub"><a href="#validate-if-the-message-is-in-pubsub" class="header-anchor">#</a> Validate if the message is in Pubsub</h3> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>docker exec <span class="token operator">-</span>it dapr_redis <span class="token operator">/</span>bin<span class="token operator">/</span>sh
keys <span class="token operator">*</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>It should return something like</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>1<span class="token punctuation">)</span> <span class="token string">&quot;alerts&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Check actual messages</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>xread STREAMS alert 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/blog/assets/img/afd6.1ce4769c.png" alt="alt"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/spark/python-learning.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        Learning Python
      </a></span> <span class="next"><a href="/blog/microservices/dapr/dapr-resources.html">
        Resources
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.5359efb0.js" defer></script><script src="/blog/assets/js/2.ed81277b.js" defer></script><script src="/blog/assets/js/5.8f43166e.js" defer></script>
  </body>
</html>