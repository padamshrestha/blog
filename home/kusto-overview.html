<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Kusto Query Language (KQL) | PS Notes</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicon.png">
    <meta name="description" content="Find all my notes here">
    <link rel="preload" href="/blog/assets/css/0.styles.165084a3.css" as="style"><link rel="preload" href="/blog/assets/js/app.5359efb0.js" as="script"><link rel="preload" href="/blog/assets/js/2.ed81277b.js" as="script"><link rel="preload" href="/blog/assets/js/27.027798ff.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.798258e1.js"><link rel="prefetch" href="/blog/assets/js/11.c40a9d89.js"><link rel="prefetch" href="/blog/assets/js/12.2bf01719.js"><link rel="prefetch" href="/blog/assets/js/13.3ded62bf.js"><link rel="prefetch" href="/blog/assets/js/14.96e88526.js"><link rel="prefetch" href="/blog/assets/js/15.02dfcd09.js"><link rel="prefetch" href="/blog/assets/js/16.d594b883.js"><link rel="prefetch" href="/blog/assets/js/17.3ca5b683.js"><link rel="prefetch" href="/blog/assets/js/18.d67bb81d.js"><link rel="prefetch" href="/blog/assets/js/19.87d7e7d4.js"><link rel="prefetch" href="/blog/assets/js/20.81bb1bdb.js"><link rel="prefetch" href="/blog/assets/js/21.393b795e.js"><link rel="prefetch" href="/blog/assets/js/22.b4b05b24.js"><link rel="prefetch" href="/blog/assets/js/23.90ebae71.js"><link rel="prefetch" href="/blog/assets/js/24.4d6315c6.js"><link rel="prefetch" href="/blog/assets/js/25.a8ca678d.js"><link rel="prefetch" href="/blog/assets/js/26.20ff403d.js"><link rel="prefetch" href="/blog/assets/js/28.4fcd7904.js"><link rel="prefetch" href="/blog/assets/js/29.ae9953be.js"><link rel="prefetch" href="/blog/assets/js/3.4239afa8.js"><link rel="prefetch" href="/blog/assets/js/30.05ce7139.js"><link rel="prefetch" href="/blog/assets/js/31.929ba55a.js"><link rel="prefetch" href="/blog/assets/js/32.39a7eb88.js"><link rel="prefetch" href="/blog/assets/js/33.aea2c7ad.js"><link rel="prefetch" href="/blog/assets/js/34.f19214f0.js"><link rel="prefetch" href="/blog/assets/js/35.f9689f85.js"><link rel="prefetch" href="/blog/assets/js/36.491b563f.js"><link rel="prefetch" href="/blog/assets/js/37.01c41598.js"><link rel="prefetch" href="/blog/assets/js/38.fef1137c.js"><link rel="prefetch" href="/blog/assets/js/39.d9080be3.js"><link rel="prefetch" href="/blog/assets/js/4.5fcdffa2.js"><link rel="prefetch" href="/blog/assets/js/40.139a3e51.js"><link rel="prefetch" href="/blog/assets/js/41.42d3a459.js"><link rel="prefetch" href="/blog/assets/js/42.f4ad466b.js"><link rel="prefetch" href="/blog/assets/js/43.d8279406.js"><link rel="prefetch" href="/blog/assets/js/44.0d320ca0.js"><link rel="prefetch" href="/blog/assets/js/45.a0bd664a.js"><link rel="prefetch" href="/blog/assets/js/46.75a5939e.js"><link rel="prefetch" href="/blog/assets/js/47.62271a73.js"><link rel="prefetch" href="/blog/assets/js/48.6519ed03.js"><link rel="prefetch" href="/blog/assets/js/5.8f43166e.js"><link rel="prefetch" href="/blog/assets/js/6.ce0118c8.js"><link rel="prefetch" href="/blog/assets/js/7.2b36b85d.js"><link rel="prefetch" href="/blog/assets/js/8.4109f0ce.js"><link rel="prefetch" href="/blog/assets/js/9.c9802138.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.165084a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/blog/" class="router-link-active no-logo home-link"><!----> <span class="site-name">PS Notes</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item ant-menu-item-selected"><a href="/blog/home/" class="router-link-active">
          Home
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/blog/about/">
          About
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Angular</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/home/deploy-angular-app-to-github-io-pages.html" title="Deploy Angular app to github.io pages" class="sidebar-link">Deploy Angular app to github.io pages</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Azure</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kusto</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/home/kusto-overview.html" aria-current="page" title="Kusto Query Language (KQL)" class="active sidebar-link">Kusto Query Language (KQL)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/home/kusto-overview.html#generic" title="Generic" class="sidebar-link">Generic</a></li><li class="sidebar-sub-header"><a href="/blog/home/kusto-overview.html#numerical-search" title="Numerical search" class="sidebar-link">Numerical search</a></li><li class="sidebar-sub-header"><a href="/blog/home/kusto-overview.html#extract-values" title="Extract values" class="sidebar-link">Extract values</a></li><li class="sidebar-sub-header"><a href="/blog/home/kusto-overview.html#string-search" title="String search" class="sidebar-link">String search</a></li><li class="sidebar-sub-header"><a href="/blog/home/kusto-overview.html#named-expressions-and-user-defined-functions" title="Named expressions and user-defined functions" class="sidebar-link">Named expressions and user-defined functions</a></li><li class="sidebar-sub-header"><a href="/blog/home/kusto-overview.html#visualizations" title="Visualizations" class="sidebar-link">Visualizations</a></li><li class="sidebar-sub-header"><a href="/blog/home/kusto-overview.html#join-tables" title="Join tables" class="sidebar-link">Join tables</a></li></ul></li><li><a href="/blog/home/dynamic-365-hcm-kusto.html" title="Troubleshoot using Kusto" class="sidebar-link">Troubleshoot using Kusto</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>C#</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/csharp/csharp-fundamentals.html" title="OOP Fundamentals" class="sidebar-link">OOP Fundamentals</a></li><li><a href="/blog/csharp/csharp-features.html" title="C# features" class="sidebar-link">C# features</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spark</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Microservices</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="kusto-query-language-kql"><a href="#kusto-query-language-kql" class="header-anchor">#</a> Kusto Query Language (KQL)</h1> <p>Official documentation
<a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/" target="_blank" rel="noopener noreferrer">KQL Documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
Course
<a href="https://app.pluralsight.com/library/courses/kusto-query-language-kql-from-scratch/table-of-contents" target="_blank" rel="noopener noreferrer">Pluralsight course<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>what is KQL and where is it used?</strong>
KQL is an open source language created by Microsoft to query big data sets stored in the Azure cloud. These queries can also be used in alerting rules. Some examples of services/products hosted in Azure that make use of KQL are:</p> <ul><li>Azure Data Explorer</li> <li>Log Analytics</li> <li>Sentinel (this is Microsoft’s cloud SIEM solution that makes use of a Log Analytics workspace as its backend)</li> <li>Microsoft Defender ATP</li></ul> <p>Sample or Demo queries can be tested at
<a href="https://portal.azure.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade" target="_blank" rel="noopener noreferrer">DemoLogs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="generic"><a href="#generic" class="header-anchor">#</a> Generic</h2> <p>A string literal with a backslash requires <strong>escaping</strong> by a backslash:
<code>&quot;a string literal with a \\ needs to be escaped&quot;</code></p> <p>The same can be achieved using a <strong>verbatim string</strong> literal by putting the @ sign in front: <code>@&quot;a verbatim string literal with a \\ that does not need to be escaped&quot;</code></p> <p>More info on escaping string data types can be found <a href="%5Bhttps://link%5D(https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types/string)">here</a>.</p> <hr> <p><strong>Add comments</strong> to your query with a double forward slash:
<code>// This is a comment</code></p> <hr> <p>The where <strong>operator and the pipe ( | ) delimiter</strong> are essential in
writing KQL queries.</p> <p>where is used to filter rows from a table. In this example we filter on events from a source, the table SecurityEvent, where the column Computer is equal to &quot;ContosoAppSrv1&quot;, and count the number of results:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SecurityEvent <span class="token operator">|</span> where Computer <span class="token operator">==</span> <span class="token string">&quot;ContosoAppSrv1&quot;</span> <span class="token operator">|</span> count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The pipe is used to separate data transformation operators. Such as:
where Computer == &quot;ContosoAppSrv1&quot;. The result can be piped to a new
operator. For example, to count the number for rows: | count</p> <hr> <p>Only include <strong>events from the last 24 hours</strong> using the ago()
function:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> where TimeGenerated <span class="token operator">&gt;</span> ago<span class="token punctuation">(</span>24h<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>For performance reasons always use time filters first in your query. The ago() function supports multiple types of timespans. More info can be found <a href="%5Bhttps://link%5D(https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types/timespan)">here</a>. For example:
• 1d 1 day
• 10m 10 minutes
• 30s 30 seconds</p> <hr> <p><strong>Select and customize the columns</strong> from the resulting table of your
query with the project operator.</p> <p>• Specify the <strong>columns to include</strong>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> project TimeGenerated, EventID, Account,
Computer, LogonType
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>• <strong>Rename columns</strong>. In this example we renamed the column
Account to UserName:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> project TimeGenerated, EventID, UserName <span class="token operator">=</span>
Account, Computer, LogonType
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>• <strong>Remove columns</strong> with project-away:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> project-away EventSourceName, Task, Level
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <p><strong>Add calculated columns</strong> to the result using the extend operator:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> extend <span class="token assign-left variable">EventAge</span><span class="token operator">=</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>-TimeGenerated
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <p><strong>Count the number of records</strong> using the count operator:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> count
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <p><strong>Match based on conditions</strong> using <a href="%5Bhttps://link%5D(https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/logicaloperators)">logical operators</a> . For example:
• T | where EventID == 4624 and LogonType == 3
• T | where EventID == 4624 or EventID == 4625
• T | where (EventID == 4624 and LogonType == 3) or
EventID == 4625</p> <hr> <p><strong>Aggerate results</strong> from your query with the summarize operator:
• Aggregate on multiple columns:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> summarize by Computer, Account
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>• Aggregate on multiple columns and return the count of the group:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> summarize count<span class="token punctuation">(</span><span class="token punctuation">)</span> by Computer, Account
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Besides count() many more very useful aggregation functions exist. An overview can be found <a href="%5Bhttps://link%5D(https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/summarizeoperator#list-of-aggregation-functions)">here</a>.</p> <hr> <p><strong>Sort the rows</strong> of the result using the sort operator:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> where EventID <span class="token operator">==</span> <span class="token number">4624</span> <span class="token operator">|</span> summarize count<span class="token punctuation">(</span><span class="token punctuation">)</span> by
AuthenticationPackageName <span class="token operator">|</span> <span class="token function">sort</span> by count_
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>By default, rows are sorted in descending order. Sorting in ascending order is also possible:
• sort by count_ asc
• Descending order: desc</p> <hr> <p><strong>Concatenate values</strong>. The result will be a string data type:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> project <span class="token assign-left variable">example</span><span class="token operator">=</span>strcat<span class="token punctuation">(</span>EventID, <span class="token string">&quot; - &quot;</span>, Channel<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>A variable number of values can be passed through the strcat function. If values are not a string, they will be forcibly converted to a string.</p> <h2 id="numerical-search"><a href="#numerical-search" class="header-anchor">#</a> Numerical search</h2> <p><strong>Search for a specific value</strong>: T | where EventID == 4688
• Not equal to: !=</p> <p>All of the numerical operators can be found <a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/numoperators" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <hr> <p>Search for a <strong>value less or greater than</strong>: T | where EventID ==
4688 | summarize count() by Process | where count_ &lt; 5
• Greater: &gt;
• Less or Equal: &lt;=
• Greater or Equal: &gt;=</p> <hr> <p>Match on <strong>multiple numeric values</strong>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> where EventID <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">4624</span>, <span class="token number">4625</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <h2 id="extract-values"><a href="#extract-values" class="header-anchor">#</a> Extract values</h2> <p><strong>Extract values from a string or JSON data</strong>. For example, extract the “process name” using a regular expression (if you are less familiar with regular expressions have a look at the split and parse function):</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SecurityAlert <span class="token operator">|</span> extend <span class="token assign-left variable">_ProcessName</span><span class="token operator">=</span>extract<span class="token punctuation">(</span><span class="token string">'&quot;process
name&quot;: &quot;(.*)&quot;'</span>, <span class="token number">1</span>, ExtendedProperties<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Because the column ExtendedProperties contains JSON data you can also use the function extractjson():</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SecurityAlert <span class="token operator">|</span> extend _ProcessName <span class="token operator">=</span>
extractjson<span class="token punctuation">(</span><span class="token string">&quot;$.process name&quot;</span>, ExtendedProperties<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>If you need to extract multiple elements from JSON data, stored as a string, you can use the function parse_json(). Use the dot notation if the data is of the type dictionary or a list of dictionaries in an array. One way to find out is through the gettype() function. To play with data stored as a dictionary have a look at the help cluster in the <a href="https://dataexplorer.azure.com/clusters/help/databases/Samples" target="_blank" rel="noopener noreferrer">Azure Data
Explorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (table: StormEvents, column: StormSummary).</p> <h2 id="string-search"><a href="#string-search" class="header-anchor">#</a> String search</h2> <p><strong>Search across all tables and columns</strong>: search &quot;<em>KEYWORD</em>&quot;
• Keep in mind that this is a performance intensive operation.</p> <hr> <p><strong>Search for a specific value</strong>: T | where ProcessName ==
@&quot;C:\Windows\System32\regsvr32.exe&quot;</p> <hr> <p>A <strong>not equal to match</strong> is done by adding an exclamation mark
as prefix:
• Equal to: ==
• Not equal to: !=
This is also supported in a similar way for other <a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/datatypes-string-operators" target="_blank" rel="noopener noreferrer">string operators<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <p>A <strong>case insensitive match</strong> can be achieved using a tilde:
• Case sensitive: ==
• Case insensitive: =~
• Case insensitive and not equal to: !~
This is also supported in a similar way for other <a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/datatypes-string-operators" target="_blank" rel="noopener noreferrer">string operators<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <hr> <p>Match on values that <strong>contain a specific string</strong>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> where CommandLine contains <span class="token string">&quot;guest&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Because has is more performant, it’s advised to use has over contains
when searching for full keywords. The following expression yields to true:
• &quot;North America&quot; has &quot;america&quot;</p> <p>contains and has are case insensitive by default. A case sensitive match
can be achieved by adding the suffix _cs: contains_cs / has_cs</p> <hr> <p>Match on values <strong>starting with or ending with a specific string</strong>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> where Computer startswith <span class="token string">&quot;contoso&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>• Ending with a specific string: endswith</p> <p>startswith and endswith are case insensitive by default. A case sensitive
match can be achieved by adding the suffix _cs: startswith_cs /
endswith_cs</p> <hr> <p><strong>Match on multiple string values</strong>: T | where Computer in
(&quot;ContosoAppSrv1&quot;, &quot;ContosoSQLSrv1&quot;)
• Not equal to: !in
• Case insensitive: in~
• Case insensitive and not equal to: !in~</p> <hr> <p>Match based on a <strong>regular expression</strong>: T | where Computer
matches regex &quot;^Contoso.*&quot;
• KQL uses the re2 library and also complies with that syntax.
Troubleshooting your regex can be done on regex101.com. Select
the regex Flavor “Golang” which also makes use of re2.</p> <p>A <strong>not equal to match</strong> can be done using the not() function:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> where not<span class="token punctuation">(</span>Computer matches regex <span class="token string">&quot;^Contoso.*&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>A <strong>case insensitive match</strong> can be achieved by providing the i flag:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>T <span class="token operator">|</span> where Computer matches regex <span class="token string">&quot;(?i)^contoso.*&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="named-expressions-and-user-defined-functions"><a href="#named-expressions-and-user-defined-functions" class="header-anchor">#</a> Named expressions and user-defined functions</h2> <p>Use the let statement to <strong>bind names to expressions</strong>. See below two examples of a named expression. Of course, much more complex expression can be created. Such as complete queries that can be nested inside another query (i.e. sub-query). For <strong>sub-queries</strong> consider the use of the materialize() function when the sub-query is called multiple times.</p> <p>Take into account the semicolon at the end of the let statement:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">let</span> _SearchWindow <span class="token operator">=</span> ago<span class="token punctuation">(</span>24h<span class="token punctuation">)</span><span class="token punctuation">;</span>
T <span class="token operator">|</span> where TimeGenerated <span class="token operator">&gt;</span> _SearchWindow

<span class="token builtin class-name">let</span> _computers <span class="token operator">=</span> dynamic<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;ContosoAppSrv1&quot;</span>,
<span class="token string">&quot;ContosoSQLSrv1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
T <span class="token operator">|</span> where Computer <span class="token keyword">in</span> <span class="token punctuation">(</span>_computers<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>The let statement can be used in many other useful ways. Such as to create <strong>user-defined functions</strong>. More info on the let statement can be found <a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/letstatement" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="visualizations"><a href="#visualizations" class="header-anchor">#</a> Visualizations</h2> <p>The render operator can be used to create visualizations. Besides the below example, more types of visualizations are possible. More info can be found <a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/renderoperator?pivots=azuredataexplorer" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. (Pie charts are not the most telling graphics, but the support for the render operator is limited on the demo environment.)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SecurityAlert <span class="token operator">|</span>
summarize <span class="token assign-left variable">Count</span><span class="token operator">=</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> by <span class="token assign-left variable">Alert</span><span class="token operator">=</span>strcat<span class="token punctuation">(</span>DisplayName,
<span class="token string">&quot; (&quot;</span>, toupper<span class="token punctuation">(</span>AlertSeverity<span class="token punctuation">)</span>, <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span>
<span class="token operator">|</span> <span class="token function">sort</span> by Count <span class="token operator">|</span> render piechart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="join-tables"><a href="#join-tables" class="header-anchor">#</a> Join tables</h2> <p>KQL has the ability to join tables. In this example, we join some of the events in the SecurityAlert table with process creation events (event ID 4688) from the SecurityEvent table. More information on joining tables can be found <a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/joinoperator?pivots=azuredataexplorer" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>This query serves purely as an example to explain the join operator because all
process data is contained within the column Entities of the SecurityAlert table</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SecurityAlert <span class="token operator">|</span>
extend _ProcessId <span class="token operator">=</span> extractjson<span class="token punctuation">(</span><span class="token string">&quot;$.process id&quot;</span>,
ExtendedProperties<span class="token punctuation">)</span>,
_ProcessCommandLine <span class="token operator">=</span> tolower<span class="token punctuation">(</span>extractjson<span class="token punctuation">(</span><span class="token string">&quot;$.command
line&quot;</span>, ExtendedProperties<span class="token punctuation">))</span>,
_HostName <span class="token operator">=</span> tolower<span class="token punctuation">(</span>extractjson<span class="token punctuation">(</span><span class="token string">&quot;$[0].HostName&quot;</span>,
Entities<span class="token punctuation">))</span>
<span class="token operator">|</span> <span class="token function">join</span> <span class="token assign-left variable">kind</span><span class="token operator">=</span>inner <span class="token punctuation">(</span>
 SecurityEvent
 <span class="token operator">|</span> where EventID <span class="token operator">==</span> <span class="token number">4688</span>
 <span class="token operator">|</span> extend <span class="token assign-left variable">_HostName</span><span class="token operator">=</span>tolower<span class="token punctuation">(</span>Computer<span class="token punctuation">)</span>
 <span class="token operator">|</span> extend <span class="token assign-left variable">_ProcessCommandLine</span><span class="token operator">=</span>tolower<span class="token punctuation">(</span>CommandLine<span class="token punctuation">)</span>
<span class="token punctuation">)</span> on <span class="token variable">$left</span>._ProcessId <span class="token operator">==</span> <span class="token variable">$right</span>.NewProcessId,
_HostName, _ProcessCommandLine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/home/starting-azure-service-fabric.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        Starting Azure Service Fabric ☁️
      </a></span> <span class="next"><a href="/blog/home/dynamic-365-hcm-kusto.html">
        Troubleshoot using Kusto
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.5359efb0.js" defer></script><script src="/blog/assets/js/2.ed81277b.js" defer></script><script src="/blog/assets/js/27.027798ff.js" defer></script>
  </body>
</html>